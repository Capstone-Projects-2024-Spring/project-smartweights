---
sidebar_position: 9
---

# Database Diagrams

SmartWeights uses a relation schema approach to the database design. It combines usage of both cloud based database (CloudKit) and local storage database (CoreData).

## CloudKit Database Design

CloudKit uses a relational database schema where every record has a relation to an iCloud user record that is created by CloudKit.

The **_User_** entity is meant to store the id that is generated by CloudKit and other relevant data. This is used as the parent for other entities.
CloudKit offers two databases:

- Public
  - Records that are accessible to all users of the application
- Private
  - Records that are only accessible to the specific iCloud user

The portions of the public database are all of the asset related entities. The public database's data is never manipulated by users, only read. These entities being:
- Achievement
- PetImage
- PetClothing
- Food
- Background

The user is able to manipulate data in their "private cloud database." These specific entities being:

- Pet
- Inventory
- FitnessData
- FitnessPlan
- Achievement

```mermaid
---
title: NoSQL ERD (Cloud base, User)
---
erDiagram

    %% User ||--||Achievement_List: has
   
    User ||--||Fitness_data: contains
    User ||--||Inventory: has
    User ||--||Pet: has
    Pet ||--|| PetImage: has
    Inventory ||--|{ PetImage: has
    Inventory ||--o{ PetClothing: has
 
    Inventory ||--o{ Food: has
    Inventory ||--o{ Background: has
    Fitness_data||--||fitness_plan: has

   User ||--o{User_Achievements:has
    Achievement ||--|{ User_Achievements: has


    Fitness_data{
        int age
        int height
        int weight

    }

    fitness_plan{

        int weight_goal
        int num_days_to_workout
    }
    User {
        string first_name
        string last_name
        int currency
        date latest_login

    }
    Pet{
        int level
        int health
        int total_xp
    }
    PetImage{
        int price
        string petName
        string PetImage_url
    }
    Inventory{
        List Background
        List Food
        List PetClothing
        List Pets
        Reference activeBackground
        Reference activePetClothing

    }
    Food{
        int price
        string food_name
        string food_image_url
    }
    Background{
        int price
        string background_name
        string background_image_url
    }
    PetClothing{
        int price
        string Name
        string Pet_Clothing_image
    }
   Achievement{
        int Achievement
        string achievement_name
        int total_progress
        string reward
    }
    User_Achievements{

         bool is_completed
        int progress_percentage

    }

```

The activeBackground and activePetClothing attributes act as references directly to their specific assets. The lists in inventory is an array of references to their specific assets. This is so an inventory can contain multiple of references, such as an inventory containing more than one type of background asset.

## CloudKit Database Design, Shop

The application's shop page retrieves the images from the database, stores, and displays them. The user does not manipulate this relevant data. It is used for the application to retrieve assets needed for the shop and to make loading assets with relevant values easier for development. 



## CoreData Database Design

The purpose of the CoreData database design is to be lightweight and to contain the information that will be received from the multiple sensors attached to the user and dumbbells. This will help provide relevant feedback for the user's workout once the data has been processed through an algorithm. There will also be a history with each feedback to allow users to revisit and see their past feedback.

There will be a form with as many workouts depending on how many sets the user is doing. The form will take all the data from several Workouts and process it through an algorithm to detect whether or not the user had good or bad form through a scoring system ( 1 to 100, 1 being worst to 100 being perfect). There will also be feedback correlated with the score and will consist of suggestions on how to fix up their form.

```mermaid
---
title: CoreData Structure
---

erDiagram
    Workout {
        workout_id INT
        user_id INT
        speed FLOAT
        velocity FLOAT
        angle FLOAT
        dateTime DATETIME
        xCoord FLOAT
        yCoord FLOAT
        zCoord FLOAT
    }
    Form {
        form_id INT
        score INT
        feedback STRING
        dateTime DATETIME
    }

    Workout }|--|| Form : has



```
